<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8"/>
		<link href="https://fonts.googleapis.com/css?family=Roboto" rel="stylesheet"/>
		<link rel="stylesheet" href= "/css/myTeam.css" type="text/css" />
		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css"/>
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.4/jquery.min.js"></script>
		<title>myTeam/Index</title>
	    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
	</head>
	<body>
		<nav class="navbar navbar-inverse navbar-static-top">
	        <div class="container">
	            <div class="navbar-header">
	                <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target=".navbar-collapse" aria-expanded="false" aria-controls="navbar">
	                    <span class="sr-only">Toggle navigation</span>
	                    <span class="icon-bar"/>
	                    <span class="icon-bar"/>
	                    <span class="icon-bar"/>
	                </button>
	                <a class="navbar-brand" href="myTeam.html">NBADex</a>
	            </div>
	            <div class="collapse navbar-collapse">
	                <ul class="nav navbar-nav navbar-right">
	                    <li class="active"><a href="myTeam.html">My Team</a></li>
	                    <li><a href="managePlayers.html">Player Management</a></li>
	                    <li><a href="myTeamStats.html">View Stats</a></li>
	                    <li><a href="seasonSimulation.html">Simulate Season</a></li>
	                    <li><a href="" id="LogOut">Log Out</a></li>
	                </ul>
	            </div>
	        </div>
	    </nav>
	    <div class="container">
	    	<h1 id="teamName"></h1>
				<div class="row first">
					<div class="col-md-2 col-md-offset-1">
						<div class="centerBlock" id="player1">
							<label>Position</label>
							<img src="../img/avatar.jpg" class="img-responsive"/>
							<label>Choose Player</label>
						</div>
					</div>
					<div class="col-md-2 ">
						<div class="centerBlock" id="player2">
							<label>Position</label>
							<img src="../img/avatar.jpg" class="img-responsive"/>
							<label>Choose Player</label>
						</div>
					</div>
					<div class="col-md-2">
						<div class="centerBlock" id="player3">
							<label>Position</label>
							<img src="../img/avatar.jpg" class="img-responsive"/>
							<label>Choose Player</label>
						</div>
					</div>
					<div class="col-md-2">
						<div class="centerBlock" id="player4">
							<label>Position</label>
							<img src="../img/avatar.jpg" class="img-responsive"/>
							<label>Choose Player</label>
						</div>
					</div>
					<div class="col-md-2">
						<div class="centerBlock" id="player5">
							<label>Position</label>
							<img src="../img/avatar.jpg" class="img-responsive"/>
							<label>Choose Player</label>
						</div>
					</div>
				</div>
				<div class="row second">
					<div class="col-md-2 col-md-offset-1">
						<div class="centerBlock" id="player6">
							<label>Position</label>
							<img src="../img/avatar.jpg" class="img-responsive"/>
							<label>Choose Player</label>
						</div>
					</div>
					<div class="col-md-2">
						<div class="centerBlock" id="player7">
							<label>Position</label>
							<img src="../img/avatar.jpg" class="img-responsive"/>
							<label>Choose Player</label>
						</div>
					</div>
					<div class="col-md-2">
						<div class="centerBlock" id="player8">
							<label>Position</label>
							<img src="../img/avatar.jpg" class="img-responsive"/>
							<label>Choose Player</label>
						</div>
					</div>
					<div class="col-md-2">
						<div class="centerBlock" id="player9">
							<label>Position</label>
							<img src="../img/avatar.jpg" class="img-responsive"/>
							<label>Choose Player</label>
						</div>
					</div>
					<div class="col-md-2">
						<div class="centerBlock" id="player10">
							<label>Position</label>
							<img src="../img/avatar.jpg" class="img-responsive"/>
							<label>Choose Player</label>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
	<footer class="footer">
		<div class="container-fluid">
			<div class="row">
				<div class="col-md-2 col-md-offset-10">
					<dl>
						<dt>Created By</dt>
						<dd>Juhyun James Oh</dd>
						<dd>Zhisheng Lie</dd>
						<dd>Kevin Kim</dd>
					</dl>
					<p>&copy; NBADex</p>
				</div>
			</div>
		</div>
	</footer>
	<script src="https://www.gstatic.com/firebasejs/3.7.0/firebase.js"></script>
	<script type="text/javascript">
			var config = {
			apiKey: "AIzaSyCcIuaDuAx9NFJKzBj4FkuR3e320eGuS_g",
			authDomain: "nbadex-ff8cf.firebaseapp.com",
			databaseURL: "https://nbadex-ff8cf.firebaseio.com",
			storageBucket: "nbadex-ff8cf.appspot.com",
			messagingSenderId: "172457613001"
			};

			firebase.initializeApp(config);
			const auth = firebase.auth();

			$(document).ready(function(){   
   				$('#LogOut').click(function() {
   					event.preventDefault();
            		firebase.auth().signOut();
    			});
			});

            firebase.auth().onAuthStateChanged(user => {
                if(user){
                    var user = firebase.auth().currentUser;
                    var teamName = "Team " + user.displayName;
                    document.getElementById("teamName").innerHTML = teamName;

                    var email, uid;
                    email = user.email;
                    uid = user.uid; 

                    var usersRef = firebase.database().ref('users');

                    //check if user/ has a child node with the name of uid
                    usersRef.once('value').then(function(snapshot) {
                        //alert(snapshot.exists());
                        var hasID = snapshot.child(String(uid)).exists();
                        if (hasID) {
                            //alert("exist: "+uid);
                            
                            //TODO: if the uid folder exist, get the player data from this folder and do further operation
                            populateTeam(uid);
                        }
                        else {
                            //if there the current uid folder does NOT exist, create one for it
                            //TODO: create uid folder can be transfer to sign up page later
                            //alert("non-exist: "+uid);
                            var tempJson = {};
                            var tempPic = '../img/avatar.jpg';
                            var player1 = {'playerName': 'Choose Player',
                            				'img': tempPic
                            				,'position': 'Position'};
                            var player2 = {'playerName': 'Choose Player',
                            				'img': tempPic
                            			,'position': 'Position'};
                            var player3 = {'playerName': 'Choose Player',
                            				'img': tempPic
                            			,'position': 'Position'};
                            var player4 = {'playerName': 'Choose Player',
                            				'img': tempPic
                            			,'position': 'Position'};
                            var player5 = {'playerName': 'Choose Player',
                            				'img': tempPic
                            			,'position': 'Position'}; 
                            var player6 = {'playerName': 'Choose Player',
                            				'img': tempPic
                            			,'position': 'Position'};
                            var player7 = {'playerName': 'Choose Player',
                            				'img': tempPic
                            			,'position': 'Position'};                            				                           			
                            var player8 = {'playerName': 'Choose Player',
                            				'img': tempPic
                            			,'position': 'Position'};  
                            var player9 = {'playerName': 'Choose Player',
                            				'img': tempPic
                            			,'position': 'Position'};  
                            var player10 = {'playerName': 'Choose Player',
                            				'img': tempPic
                            			,'position': 'Position'};                              				                            				
                            tempJson[uid] = {'username': email,
                        					player1,
                        					player2,
                        					player3,
                        					player4,
                        					player5,
                        					player6,
                        					player7,
                        					player8,
                        					player9,
                        					player10};
                            var database = firebase.database();
                            database.ref('users').update(tempJson);
                            //populateTeam(uid);
                        }
                    });

                    function populateTeam(uid){
                    	firebase.database().ref('users/'+uid).once('value').then(function(snapshot){
                    		//var i = 1;
                    		snapshot.forEach(function(childSnapshot){
                    			if((childSnapshot.key).includes('player')){
                    				//var player = childSnapshot.val();
                    				var player = document.getElementById(childSnapshot.key);
                    				player.children[0].innerHTML = childSnapshot.val().position;
                    				player.children[1].src = childSnapshot.val().img;
                    				player.children[2].innerHTML = childSnapshot.val().playerName;
                    			}
                    			//i++;
                    			//var player = childSnapshot.val();
                    		});
                    	});

                    	/*
                    	firebase.database().ref('users/'+uid).once('value').then(function(snapshot) {
                			var player1 = document.getElementById("player1");
                			player1.children[0].innerHTML = snapshot.val().player1.position;
                			player1.children[1].src = snapshot.val().player1.img;
                			console.log(snapshot.val().player1.img);
                			player1.children[2].innerHTML = snapshot.val().player1.playerName;
                			var player2 = document.getElementById("player2");
                			player2.children[0].innerHTML = snapshot.val().player2.position;
                			player2.children[1].src = snapshot.val().player2.img;
                			player2.children[2].innerHTML = snapshot.val().player2.playerName;
                			var player3 = document.getElementById("player3");
                			player3.children[0].innerHTML = snapshot.val().player3.position;
                			player3.children[1].src = snapshot.val().player3.img;
                			player3.children[2].innerHTML = snapshot.val().player3.playerName;
                			var player4 = document.getElementById("player4");
                			player4.children[0].innerHTML = snapshot.val().player4.position;
                			player4.children[1].src = snapshot.val().player4.img;
                			player4.children[2].innerHTML = snapshot.val().player4.playerName;
                			var player5 = document.getElementById("player5");
                			player5.children[0].innerHTML = snapshot.val().player5.position;
                			player5.children[1].src = snapshot.val().player5.img;
                			player5.children[2].innerHTML = snapshot.val().player5.playerName;
                			var player6 = document.getElementById("player6");
                			player6.children[0].innerHTML = snapshot.val().player6.position;
                			player6.children[1].src = snapshot.val().player6.img;
                			player6.children[2].innerHTML = snapshot.val().player6.playerName;
                			var player7 = document.getElementById("player7");
                			player7.children[0].innerHTML = snapshot.val().player7.position;
                			player7.children[1].src = snapshot.val().player7.img;
                			player7.children[2].innerHTML = snapshot.val().player7.playerName;
                			var player8 = document.getElementById("player8");
                			player8.children[0].innerHTML = snapshot.val().player8.position;
                			player8.children[1].src = snapshot.val().player8.img;
                			player8.children[2].innerHTML = snapshot.val().player8.playerName;
                			var player9 = document.getElementById("player9");
                			player9.children[0].innerHTML = snapshot.val().player9.position;
                			player9.children[1].src = snapshot.val().player9.img;
                			player9.children[2].innerHTML = snapshot.val().player9.playerName;
                			var player10 = document.getElementById("player10");
                			player10.children[0].innerHTML = snapshot.val().player10.position;
                			player10.children[1].src = snapshot.val().player10.img;
                			player10.children[2].innerHTML = snapshot.val().player10.playerName;
            			});*/
                    } 
                }
                else{
                	window.location = '../index.html';
                }
            });
        


	</script>

</body>
</html>

